apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: traefik-internal
spec:
  generators:
  - list:
      elements:
      - name: safi-cicd
        server: https://kubernetes.default.svc
        values:
          override: |
            deployment:
              replicas: 3
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.19.0.253
      - name: safi-stage-apps
        server: https://172.17.47.219:8081
        values:
          override: |
            deployment:
              replicas: 3
              podLabels:
                sidecar.istio.io/inject: 'true'
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.17.47.253
      - name: safi-stage-tyk
        server: https://172.17.96.9:8081
        values:
          override: |
            deployment:
              replicas: 3
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.17.111.253
      - name: safi-stage-monitor
        server: https://172.17.80.8:8081
        values:
          override: |
            deployment:
              replicas: 3
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.17.95.253
      # - name: safi-stage-hcv
      #   server: https://172.17.64.9:8081
      #   values:
      #     override: |
      #       deployment:
      #         kind: DaemonSet
      #       ingressClass:
      #         enabled: true
      #       ingressRoute:
      #         dashboard:
      #           enabled: false
      #       providers:
      #         kubernetesIngress:
      #           ingressClass: traefik-internal
      #           publishedService:
      #             enabled: true
      #       service:
      #         annotations:
      #           cloud.google.com/load-balancer-type: "Internal"
      #         spec:
      #           loadBalancerIP: 172.17.79.253
      - name: safi-stage-vpn
        server: https://172.17.128.5:8081
        values:
          override: |
            deployment:
              replicas: 3
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.17.143.253
      - name: safi-brave-applications
        server: https://172.21.32.16:8081
        values:
          override: |
            deployment:
              replicas: 3
              podLabels:
                sidecar.istio.io/inject: 'true'
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.21.47.253
      - name: safi-brave-tyk-a
        server: https://172.21.96.10:8081
        values:
          override: |
            deployment:
              replicas: 1
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            #service:
            #  annotations:
            #    cloud.google.com/load-balancer-type: "Internal"
            #  spec:
            #    loadBalancerIP: 172.21.111.253
      - name: safi-brave-monitor
        server: https://172.21.80.5:8081
        values:
          override: |
            deployment:
              replicas: 3
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.21.95.253
      - name: safi-brave-hcvault
        server: https://172.21.64.9:8081
        values:
          override: |
            deployment:
              replicas: 3
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.21.79.253
      - name: safi-brave-vpn
        server: https://172.21.128.11:8081
        values:
          override: |
            deployment:
              replicas: 3
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.21.143.253
      - name: safi-brave-tms
        server: https://172.21.0.11:8081
        values:
          override: |
            deployment:
              replicas: 3
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.21.15.253

      - name: safi-tangled-applications
        server: https://172.22.32.14:8081
        values:
          override: |
            deployment:
              replicas: 3
              podLabels:
                sidecar.istio.io/inject: 'true'
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.22.47.253
      - name: safi-tangled-tyk-a
        server: https://172.22.96.5:8081
        values:
          override: |
            deployment:
              replicas: 3
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.22.111.253
      - name: safi-tangled-monitor
        server: https://172.22.80.8:8081
        values:
          override: |
            deployment:
              replicas: 3
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.22.95.253
      - name: safi-tangled-hcvault
        server: https://172.22.64.9:8081
        values:
          override: |
            deployment:
              replicas: 3
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.22.79.253
      - name: safi-tangled-vpn
        server: https://172.22.128.5:8081
        values:
          override: |
            deployment:
              replicas: 3
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.22.143.253
      - name: safi-tangled-tms
        server: https://172.22.0.24:8081
        values:
          override: |
            deployment:
              replicas: 3
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.22.15.253

      - name: safi-dev-hcvault
        server: https://172.16.64.9:8081
        values:
          override: |
            deployment:
              replicas: 3
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.16.79.253
      - name: safi-dev-tms
        server: https://172.16.0.5:8081
        values:
          override: |
            deployment:
              replicas: 3
            podDisruptionBudget:
              enabled: true
              maxUnavailable: 1
            ingressClass:
              enabled: true
              isDefaultClass: true
            ingressRoute:
              dashboard:
                enabled: false
            providers:
              kubernetesIngress:
                ingressClass: traefik-internal
                publishedService:
                  enabled: true
            ports:
              metrics:
                expose: true
            resources:
              requests:
                cpu: "100m"
                memory: "50Mi"
              limits:
                cpu: "300m"
                memory: "150Mi"
            metrics:
              prometheus:
                serviceMonitor:
                  relabelings:
                    - sourceLabels: [__meta_kubernetes_pod_node_name]
                      separator: ;
                      regex: ^(.*)$
                      targetLabel: nodename
                      replacement: $1
                      action: replace
                  jobLabel: traefik
                  scrapeInterval: 30s
                  scrapeTimeout: 5s
                  honorLabels: true
            tlsOptions:
              default:
                minVersion: VersionTLS12
                sniStrict: true
                cipherSuites:
                  - TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256
                  - TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
                  - TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305
                  - TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305
                curvePreferences:
                  - CurveP521
                  - CurveP384
            service:
              annotations:
                cloud.google.com/load-balancer-type: "Internal"
              spec:
                loadBalancerIP: 172.16.15.253
  template:
    metadata:
      name: '{{name}}-traefik-internal'
    spec:
      project: dev-infra
      source:
        chart: traefik
        repoURL: https://helm.traefik.io/traefik
        targetRevision: 20.3.0
        helm:
          releaseName: traefik-internal
          values: | 
              {{values.override}}
      destination:
        server: '{{server}}'
        namespace: traefik
      syncPolicy:
        automated:
          prune: true
        syncOptions:
        - CreateNamespace=true
        - Replace=true
        retry:
          limit: 5
          backoff:
            duration: 5s
            factor: 2
            maxDuration: 3m
